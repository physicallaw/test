---
title: 메모리 계층구조
parent: 컴퓨터 구조
nav_order: 1
date: 2024-11-26
excerpt: 메모리 계층구조는 컴퓨터 시스템에서 속도와 비용을 최적화하기 위해 다양한 유형의 메모리를 계층적으로 배치한 구조입니다.
permalink: /memory-hierarchy.html
math: mathjax
---

## Table of contents
{: .no_toc .text-delta }

1. TOC
{:toc}

## 메모리 계층구조란?

![메모리 계층구조](/assets/images/memory-hierarchy.png)

**메모리 계층구조(Memory Hierarchy)**는 컴퓨터 시스템의 성능을 최적화하기 위해 다양한 수준의 메모리 저장소를 활용하는 방식을 의미한다. 메모리 계층구조는 속도, 비용, 크기 사이의 균형을 맞추기 위해 설계되었으며, 가장 빠르고 비싸지만 크기가 작은 메모리에서 가장 느리지만 저렴하고 크기가 큰 메모리까지 다양한 종류의 메모리를 포함한다. 메모리 계층구조의 목표는 CPU가 자주 사용하는 데이터를 빠르게 접근할 수 있게 하고, 덜 자주 사용되는 데이터는 상대적으로 느리고 용량이 큰 메모리에 저장되도록 하는 것이다.

## 지역성의 원칙

**지역성 원칙(Principle of Locality)**은 프로그램이 짧은 시간 동안 메모리의 작은 부분을 반복적으로 접근하는 경향을 설명한다. 이 원칙은 예측 가능한 메모리 접근 패턴을 활용하여 효율적인 메모리 시스템, 특히 캐시 시스템을 설계하는 데 활용된다.

### 시간적 지역성

**시간적 지역성(Temporal Locality)**은 프로그램이 짧은 시간 동안 동일한 메모리 위치를 반복적으로 접근하는 경향을 말한다. 캐시는 최근에 접근된 데이터를 더 빠르고 작은 메모리(예: CPU 캐시)에 저장하여 시간적 지역성을 활용합니다. 만약 데이터가 곧바로 다시 접근된다면, 느린 메모리에서 데이터를 가져오는 대신 캐시에서 빠르게 데이터를 불러올 수 있다.

### 공간적 지역성

**공간 지역성(Spatial Locality)**은 프로그램이 짧은 시간 동안 서로 인접한 메모리 위치를 접근하는 경향을 말한다. 캐시는 요청된 데이터뿐만 아니라 근처의 데이터도 미리 가져오는 방식으로 공간 지역성을 활용한다(블록이나 청크 단위로). 이렇게 하면 프로그램이 인접한 메모리 위치에 접근할 때, 해당 데이터들이 미리 캐시에 로드되어 빠르게 접근할 수 있다.

## 블록과 라인

메모리 계층구조에서 **블록(block)** 또는 **라인(line)**은 서로 다른 메모리 계층 수준 간에 전송되는 데이터의 단위이다. "블록"은 주로 캐시 메모리와 관련된 시스템에서 사용되며, "라인"은 CPU나 캐시 서브시스템과 같은 시스템에서 자주 사용된다.

CPU가 데이터를 필요로 할 때, 먼저 캐시에서 해당 데이터가 있는지 확인한다. 만약 데이터가 캐시에 없다면(캐시 미스), 데이터를 포함한 블록을 메인 메모리에서 캐시로 가져온다.

블록은 고정 크기의 데이터 단위이다. 블록 크기는 캐시 성능에 중요한 영향을 미친다. 블록이 너무 작으면 비효율적인 메모리 접근 패턴이 발생할 수 있고, 너무 크면 사용되지 않는 데이터를 불필요하게 전송하게 될 수 있다.

## 적중과 실패

### 적중

**적중(Hit)**은 CPU가 요청한 데이터나 명령어를 캐시에서 찾았을 때 발생한다. 즉, 요청한 데이터가 이미 캐시에 저장되어 있어, 더 느린 메인 메모리(RAM)로 접근할 필요 없이 빠르게 데이터에 접근할 수 있는 경우이다.

적중률은 모든 메모리 접근 중 적중이 발생한 비율을 나타낸다.


$$
\text{히트율} = \frac{\text{히트 수}}{\text{전체 접근 수}} \times 100
$$

### 실패

**실패(Miss)**는 CPU가 캐시에서 데이터를 찾으려 했지만, 해당 데이터가 캐시에 없을 때 발생한다. 이 경우, 요청한 데이터를 더 느린 메모리에서 가져와야 한다. 미스가 발생하면 데이터 접근 시간이 더 길어지므로 성능이 저하된다.

실패율은 모든 메모리 접근 중 실패가 발생한 비율을 나타낸다.

$$
\text{미스율} = 1 - \text{히트율} = \frac{\text{미스 수}}{\text{전체 접근 수}} \times 100
$$

## 히트 타임과 실패 손실

**히트 타임(hit time)**은 캐시에서 데이터를 찾을 수 있을 때(즉, "히트"가 발생했을 때) 그 데이터를 접근하는 데 걸리는 시간을 의미한다. 반면, **실패 손실(miss penalty)**은 요청한 데이터가 캐시에 없어서 하위 메모리(예: 주 메모리나 디스크)에서 데이터를 가져와야 할 때 발생하는 시간 지연을 말한다.

히트 타임은 주소 변환, 캐시 조회, 캐시에서 데이터 검색에 드는 시간을 포함하며, 일반적으로 더 느린 메모리 계층에서 데이터를 접근하는 시간보다 훨씬 짧다. 반면, 미스 페널티는 더 느린 메모리 계층에서 데이터를 가져오는 데 추가로 필요한 시간을 의미하며, 이 시간에는 다음 단계의 메모리를 접근하는 시간도 포함된다. 미스 페널티는 시스템 성능에 상당한 영향을 미칠 수 있다. 효율적인 메모리 계층은 히트 타임을 최소화하고 미스 페널티를 줄여 데이터 접근 속도를 최적화하는 것을 목표로 한다.